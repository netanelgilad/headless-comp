---
import type { products } from "@wix/stores";
import { SelectedVariantStoreContext } from "./VariantSelectorContext";
import { createSelectedVariantStore, type SelectedVariantStoreInput } from "../stores/SelectedVariantStore";
import { getCurrentCartStoreId } from "../CurrentCart/CurrentCartContext";
import GenericStore from "../GenericStore.astro";

type Props = {
    product: products.Product;
};

const currentCartStoreId = getCurrentCartStoreId();

const storeInput: SelectedVariantStoreInput = {
    productOptions: Astro.props.product.productOptions!,
    manageVariants: Astro.props.product.manageVariants!,
    variants: Astro.props.product.variants ?? [],
    name: Astro.props.product.name!,
    priceData: Astro.props.product.priceData!,
    stock: Astro.props.product.stock!,
    _id: Astro.props.product._id!,
    currentCartStoreId,
};
---

<GenericStore
    {...storeInput}
    storeSlug="selectedVariant"
    storeFactory={createSelectedVariantStore}>
    {(storeId: string) =>
        <SelectedVariantStoreContext storeId={storeId}>
            <slot />
        </SelectedVariantStoreContext>
    }
</GenericStore>

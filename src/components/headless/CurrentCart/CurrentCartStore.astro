---
import { currentCart } from "@wix/ecom";
import { CurrentCartContext } from "./CurrentCartContext";
import { createCurrentCartStore } from "../stores/CurrentCartStore";
import GenericStore from "../GenericStore.astro";

type Props = {};

let initialCart:
    | (currentCart.Cart & currentCart.CartNonNullableFields)
    | undefined;
try {
    initialCart = await currentCart.getCurrentCart();
} catch (e) {
    if ((e as any).details.applicationError.code === "OWNED_CART_NOT_FOUND") {
        initialCart = undefined;
    } else {
        throw e;
    }
}

const initialState = {
    initialCart,
};
---

<GenericStore
    {...initialState}
    storeSlug="currentCart"
    storeFactory={createCurrentCartStore}>
    {(storeId: string) =>
        <script>
            import "../stores/CurrentCartStore";
        </script>
        <CurrentCartContext storeId={storeId}>
            <slot />
        </CurrentCartContext>
    }
</GenericStore>

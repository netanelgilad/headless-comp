---
import type { SelectedVariantStoreInput } from "./SelectedVariantStore";
import { createSelectedVariantStore } from "./SelectedVariantStore";
import { SelectedVariantStoreContext } from "./SelectedVariantStoreContext";
import { addStore } from "./StoreManager";

type Props = SelectedVariantStoreInput;

const storeId = crypto.randomUUID();
const selectedVariantStore = createSelectedVariantStore(Astro.props);
addStore(storeId, selectedVariantStore);
---

<selected-variant-store
    data-id={storeId}
    data-initial-state={JSON.stringify(Astro.props)}></selected-variant-store>
<script>
    import { createSelectedVariantStore } from "./SelectedVariantStore";
    import { addStore } from "./StoreManager";

    class SelectedVariantStore extends HTMLElement {
        constructor() {
            super();
            const selectedVariantStore = createSelectedVariantStore(
                JSON.parse(this.dataset.initialState!),
            );
            addStore(this.dataset.id!, selectedVariantStore);
        }
    }

    customElements.define("selected-variant-store", SelectedVariantStore);
</script>
<SelectedVariantStoreContext storeId={storeId}>
    <slot />
</SelectedVariantStoreContext>
